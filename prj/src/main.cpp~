/*!
 *\file 
 *\brief Modul glowny.
 *
 * Plik zawiera funkcje main.
 */

#include <cstdlib>
#include <iomanip>
#include <unistd.h>

using namespace std;

/*!
 *\brief Funkcja glowna programu.
 */
int main(int argc, char **argv)
{

  string typ_opcja;

  string konfiguracja;
  string scena;
  vector<string> postury_glownego;
  vector<string> nazwy_przeszkod;

  Scena Krajobraz;

  PzG::LaczeDoGNUPlota Lacze;
 
  if(argc!=1)
    {
      for(int i=1;argv[i]!=NULL;++i) //petla czytajaca nazwy az do konca
	{
	  getopt(argc,argv,"");
	  if(i==1)
	    {
	      konfiguracja=argv[i]; //Wczytanie nazwy pliku konfiguracji
	    }
	  if(i==2)
	    {
	      scena=argv[i]; //Wczytanie nazwy pliku sceny
	    }
	  if(i!=1 && i!=2)
	    {
	      postury_glownego.push_back(argv[i]); //wczytanie wektora nazw plikow postury
	    }
	}


      Lacze.Inicjalizuj();  // Tutaj startuje gnuplot.
      Lacze.ZmienTrybRys(PzG::TR_2D);
      Lacze.UstawZakresY(-5,50);
      Lacze.UstawZakresX(-50,50);

      nazwy_przeszkod=Krajobraz.WczytajPlikSceny(scena); 


      for(unsigned int i=0;i<nazwy_przeszkod.size();++i)
	{
	  Lacze.DodajNazwePliku(nazwy_przeszkod[i].c_str(),PzG::RR_Ciagly,4);   
	  Lacze.DodajNazwePliku(nazwy_przeszkod[i].c_str(),PzG::RR_Punktowy,2);
	}


      Krajobraz.DodajGlowny(konfiguracja);                   

      Lacze.DodajNazwePliku("Glowny",PzG::RR_Ciagly,4);     
      Lacze.DodajNazwePliku("Glowny",PzG::RR_Punktowy,2);   

      Lacze.Rysuj(); //rysowanie lacza
      sleep(3);

      for(int i=0;postury_glownego[i].c_str()!=NULL;++i)
	{
	  Krajobraz.PrzemiescGlowny(postury_glownego[i]);
	  Krajobraz.SprawdzKolizje();

	  Lacze.Rysuj();                                  
	  sleep(2);
	}
    }
  else
    {
      cerr<<endl<<"ERROR!! Zle wywolanie programu."<<endl<<endl; //gdy brak argumentow wejsciowych
    }
  return 0;
}
